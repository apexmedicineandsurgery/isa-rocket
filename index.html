<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Standard Atmosphere Explorer ðŸš€</title>
<style>
  :root{
    --w: 960px;
    --panel: 380px;
    --skyH: 540px;
    --brand: #0e7490;
  }
  *{box-sizing:border-box}
  body{
    margin:0; font:16px/1.45 system-ui,Segoe UI,Roboto,Arial,sans-serif; color:#0f172a; background:#f8fafc;
    display:flex; justify-content:center; padding:24px;
  }
  .app{
    width: min(100%, var(--w));
    background:white; border:1px solid #e2e8f0; border-radius:12px; box-shadow:0 6px 24px rgba(2,6,23,.08);
    overflow:hidden;
  }
  header{padding:16px 20px; border-bottom:1px solid #e2e8f0; display:flex; gap:12px; align-items:center; flex-wrap:wrap}
  header h1{font-size:18px; margin:0}
  header .sub{color:#475569}

  .content{display:flex; gap:16px; padding:16px; flex-wrap:wrap}
  .viz{flex:1 1 480px; min-width:420px}
  .panel{flex:0 0 var(--panel); min-width:320px; border-left:1px solid #e2e8f0; padding:12px}

  /* Atmosphere column */
  .sky{
    position:relative; height:var(--skyH); border-radius:10px; overflow:hidden;
    background: linear-gradient(#9ad0ff 0%, #78b9ff 35%, #3575c3 60%, #0b2a52 85%, #000 100%);
    border:1px solid #dbeafe;
  }
  .scale{
    position:absolute; left:8px; top:8px; bottom:8px; width:48px; background:rgba(255,255,255,.12); border-radius:8px;
    display:flex; flex-direction:column; justify-content:space-between; align-items:center; padding:8px 4px; color:#e2e8f0; font-size:12px;
  }
  .scale::after{content:"Altitude (km)"; writing-mode:vertical-rl; transform:rotate(180deg); font-size:11px; opacity:.8}

  /* Layer bands (approx ISA 1976 layers) */
  .band{position:absolute; left:64px; right:0; opacity:.22}
  .tropos{background:#fff; top:calc(var(--skyH) - var(--skyH) * 11/80); height:calc(var(--skyH) * 11/80);}
  .strato1{background:#ffdd57; top:calc(var(--skyH) - var(--skyH) * 20/80); height:calc(var(--skyH) * 9/80);}
  .strato2{background:#f97316; top:calc(var(--skyH) - var(--skyH) * 32/80); height:calc(var(--skyH) * 12/80);}
  .strato3{background:#fb7185; top:calc(var(--skyH) - var(--skyH) * 47/80); height:calc(var(--skyH) * 15/80);}
  .meso1{background:#a78bfa; top:calc(var(--skyH) - var(--skyH) * 51/80); height:calc(var(--skyH) * 4/80);}
  .meso2{background:#60a5fa; top:calc(var(--skyH) - var(--skyH) * 71/80); height:calc(var(--skyH) * 20/80);}

  .band-label{
    position:absolute; left:72px; font-size:12px; color:#0f172a; mix-blend-mode:luminosity; opacity:.9; padding:2px 6px; border-radius:6px; background:rgba(255,255,255,.25)
  }

  /* Rocket */
  .rocket{
    position:absolute; left:120px; width:36px; height:36px; transform:translateY(0);
    display:grid; place-items:center;
  }
  .rocket svg{filter:drop-shadow(0 2px 4px rgba(0,0,0,.35))}
  .flame{transform-origin:50% 0%; animation:flame .12s infinite alternate ease-in}
  @keyframes flame{from{transform:scaleY(.8)} to{transform:scaleY(1.15)}}

  /* Controls */
  .controls{display:grid; gap:12px; padding:8px}
  .row{display:flex; align-items:center; gap:10px; flex-wrap:wrap}
  .row label{min-width:120px; color:#334155}
  input[type=range]{width:100%}
  .btn{
    background:var(--brand); color:white; border:none; padding:10px 14px; border-radius:8px; cursor:pointer;
    box-shadow:0 4px 10px rgba(14,116,144,.3)
  }
  .btn:disabled{opacity:.5; cursor:not-allowed}
  .small{font-size:12px; color:#64748b}

  /* Readouts */
  .grid{
    display:grid; grid-template-columns:1fr 1fr; gap:10px; padding:8px;
  }
  .card{
    background:#f1f5f9; border:1px solid #e2e8f0; border-radius:8px; padding:10px;
  }
  .card h3{margin:0 0 6px; font-size:14px; color:#0f172a}
  .val{font-size:18px; font-weight:600}
  .unit{font-size:12px; color:#475569; margin-left:6px}

  footer{padding:12px 16px; color:#64748b; border-top:1px solid #e2e8f0; font-size:12px}
  code{background:#e2e8f0; padding:2px 6px; border-radius:6px}
</style>
</head>
<body>
<div class="app" id="app">
  <header>
    <h1>Standard Atmosphere Explorer</h1>
    <div class="sub">Interactive ISA (0â€“80 km) with rocket ascent visualization</div>
  </header>

  <div class="content">
    <section class="viz">
      <div class="sky" id="sky">
        <!-- altitude scale -->
        <div class="scale" id="scale">
          <div>80</div><div>60</div><div>40</div><div>20</div><div>0</div>
        </div>

        <!-- Layer bands (visual only) -->
        <div class="band tropos"></div>
        <div class="band strato1"></div>
        <div class="band strato2"></div>
        <div class="band strato3"></div>
        <div class="band meso1"></div>
        <div class="band meso2"></div>

        <!-- Labels -->
        <div class="band-label" style="top: calc(var(--skyH) - var(--skyH)*5.5/80);">Troposphere (0â€“11 km)</div>
        <div class="band-label" style="top: calc(var(--skyH) - var(--skyH)*16/80);">Lower Stratosphere (11â€“20 km)</div>
        <div class="band-label" style="top: calc(var(--skyH) - var(--skyH)*28/80);">Mid Stratosphere (20â€“32 km)</div>
        <div class="band-label" style="top: calc(var(--skyH) - var(--skyH)*40/80);">Upper Stratosphere (32â€“47 km)</div>
        <div class="band-label" style="top: calc(var(--skyH) - var(--skyH)*50/80);">Stratopause (47â€“51 km)</div>
        <div class="band-label" style="top: calc(var(--skyH) - var(--skyH)*61/80);">Mesosphere (51â€“80 km)</div>

        <!-- Rocket -->
        <div class="rocket" id="rocket" aria-label="rocket">
          <svg width="36" height="36" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" role="img">
            <defs>
              <linearGradient id="fl" x1="0" x2="0" y1="0" y2="1">
                <stop offset="0" stop-color="#ffd166"/>
                <stop offset=".6" stop-color="#ef4444"/>
                <stop offset="1" stop-color="#7c2d12"/>
              </linearGradient>
            </defs>
            <!-- body -->
            <path d="M32 4c8 6 12 16 12 28 0 12-4 16-12 24-8-8-12-12-12-24 0-12 4-22 12-28z" fill="#e2e8f0" stroke="#0f172a" stroke-width="2"/>
            <circle cx="32" cy="24" r="6" fill="#60a5fa" stroke="#0f172a" stroke-width="2"/>
            <!-- fins -->
            <path d="M20 42l-8 6 8-2z" fill="#ef4444"/><path d="M44 42l8 6-8-2z" fill="#ef4444"/>
            <!-- flame -->
            <path class="flame" d="M32 58c-4-6 0-10 0-10s4 4 0 10z" fill="url(#fl)"/>
          </svg>
        </div>
      </div>
    </section>

    <aside class="panel">
      <div class="controls">
        <div class="row">
          <label for="alt">Altitude (m)</label>
          <input type="range" id="alt" min="0" max="80000" step="10" value="0" />
          <input type="number" id="altNum" min="0" max="80000" step="10" value="0" style="width:110px;padding:6px;border:1px solid #cbd5e1;border-radius:8px"/>
        </div>
        <div class="row">
          <button class="btn" id="launch">Play launch</button>
          <button class="btn" id="pause" disabled>Pause</button>
          <span class="small">Rate: <input type="range" id="rate" min="50" max="800" step="10" value="250"> <span id="rateLbl" class="small">250 m/s</span></span>
        </div>
      </div>

      <div class="grid">
        <div class="card"><h3>Layer</h3><div class="val" id="layerName">Troposphere</div></div>
        <div class="card"><h3>Temperature</h3><div><span class="val" id="T">288.15</span><span class="unit">K</span></div></div>
        <div class="card"><h3>Pressure</h3><div><span class="val" id="P">101325</span><span class="unit">Pa</span></div></div>
        <div class="card"><h3>Density</h3><div><span class="val" id="rho">1.225</span><span class="unit">kg/mÂ³</span></div></div>
        <div class="card"><h3>Speed of sound</h3><div><span class="val" id="a">340.29</span><span class="unit">m/s</span></div></div>
        <div class="card"><h3>Geopotential note</h3><div class="small">Using geometric altitude approximation (0â€“80 km).</div></div>
      </div>
    </aside>
  </div>

  <footer>
    ISA 1976 layer set used for calculations (0â€“80 km). Equations assume dry air, mean seaâ€‘level constants and hydrostatic balance. For operations, compare against realâ€‘time atmos data.
  </footer>
</div>

<script>
/* Constants */
const g0 = 9.80665;                   // m/s^2
const R  = 287.05287;                 // J/(kgÂ·K)
const gamma = 1.4;                    // ratio of specific heats
const T0 = 288.15;                    // K
const P0 = 101325;                    // Pa

/* ISA 1976 layers up to 80 km (geometric approx):
   hb (m), L (K/m), label
   Lapse rate L is per layer (K/m). */
const layers = [
  { hb:    0,    L: -0.0065, label: "Troposphere (0â€“11 km)" },
  { hb: 11000,   L:  0.0,    label: "Lower Stratosphere (11â€“20 km)" },
  { hb: 20000,   L:  0.0010, label: "Stratosphere (20â€“32 km)" },
  { hb: 32000,   L:  0.0028, label: "Stratosphere (32â€“47 km)" },
  { hb: 47000,   L:  0.0,    label: "Stratopause (47â€“51 km)" },
  { hb: 51000,   L: -0.0028, label: "Mesosphere (51â€“71 km)" },
  { hb: 71000,   L: -0.0020, label: "Mesosphere (71â€“80 km)" }
];

/* Precompute base T and P for each layer for continuity */
function computeBases() {
  layers[0].Tb = T0;
  layers[0].Pb = P0;

  for (let i = 1; i < layers.length; i++) {
    const prev = layers[i-1];
    const curr = layers[i];
    const hdiff = curr.hb - prev.hb;

    // Temperature at start of this layer
    curr.Tb = prev.L !== 0
      ? prev.Tb + prev.L * hdiff
      : prev.Tb;

    // Pressure at start of this layer
    if (prev.L !== 0) {
      curr.Pb = prev.Pb * Math.pow(curr.Tb / prev.Tb, -g0 / (prev.L * R));
    } else {
      curr.Pb = prev.Pb * Math.exp(-g0 * hdiff / (R * prev.Tb));
    }
  }
}
computeBases();

/* Find active layer for altitude h (m) */
function getLayer(h) {
  let idx = layers.length - 1;
  for (let i = 0; i < layers.length; i++) {
    if (h < layers[i].hb) { idx = Math.max(0, i - 1); break; }
  }
  return {idx, base: layers[idx]};
}

/* ISA state at altitude h (0â€“80,000 m) */
function isa(h) {
  h = Math.max(0, Math.min(80000, h));
  const { idx, base } = getLayer(h);
  const hb = base.hb, Tb = base.Tb, Pb = base.Pb, L = base.L;
  const dh = h - hb;

  let T, P;
  if (L === 0) {
    T = Tb;
    P = Pb * Math.exp(-g0 * dh / (R * Tb));
  } else {
    T = Tb + L * dh;
    P = Pb * Math.pow(T / Tb, -g0 / (L * R));
  }
  const rho = P / (R * T);
  const a = Math.sqrt(gamma * R * T);
  return { T, P, rho, a, label: base.label };
}

/* UI wiring */
const alt = document.getElementById('alt');
const altNum = document.getElementById('altNum');
const TEl = document.getElementById('T');
const PEl = document.getElementById('P');
const rhoEl = document.getElementById('rho');
const aEl = document.getElementById('a');
const layerEl = document.getElementById('layerName');
const rocket = document.getElementById('rocket');
const sky = document.getElementById('sky');
const launchBtn = document.getElementById('launch');
const pauseBtn = document.getElementById('pause');
const rate = document.getElementById('rate');
const rateLbl = document.getElementById('rateLbl');

function fmt(n, d=2) { return n.toLocaleString(undefined, {maximumFractionDigits:d, minimumFractionDigits:d}); }
function fmtExp(n) { return n.toExponential(3).replace('e',' Ã—10^'); }

function setAltitude(h) {
  alt.value = h; altNum.value = h;
  const {T,P,rho,a,label} = isa(h);
  TEl.textContent = fmt(T,2);
  PEl.textContent = fmt(P,0);
  rhoEl.textContent = fmt(rho,4);
  aEl.textContent = fmt(a,2);
  layerEl.textContent = label;

  // Move rocket: map 0..80,000 m to bottom..top of sky box
  const skyH = sky.getBoundingClientRect().height;
  const y = skyH - (h/80000)*skyH - 18; // center offset
  rocket.style.transform = `translateY(${y}px)`;
}

let anim = null;
function tick(tsPrev, lastH){
  anim = requestAnimationFrame((tsNow) => {
    const dt = Math.min(1/30, (tsNow - tsPrev)/1000); // cap timestep
    const v = parseFloat(rate.value); // m/s
    const h = Math.min(80000, lastH + v*dt);
    setAltitude(h);
    if (h >= 80000) { stop(); return; }
    tick(tsNow, h);
  });
}

function start(){
  launchBtn.disabled = true; pauseBtn.disabled = false;
  const startH = parseFloat(alt.value);
  const now = performance.now();
  tick(now, startH);
}
function stop(){
  launchBtn.disabled = false; pauseBtn.disabled = true;
  if (anim) cancelAnimationFrame(anim);
  anim = null;
}

alt.addEventListener('input', e => setAltitude(parseFloat(e.target.value)));
altNum.addEventListener('input', e => setAltitude(parseFloat(e.target.value)||0));
launchBtn.addEventListener('click', start);
pauseBtn.addEventListener('click', stop);
rate.addEventListener('input', e => rateLbl.textContent = `${e.target.value} m/s`);

/* initial */
setAltitude(0);
</script>
</body>
</html>
